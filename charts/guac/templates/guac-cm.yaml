# Copyright Kusari, Inc. and contributors
# Licensed under the MIT license. See LICENSE file in the project root for details.
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: guac-cm
data:
  guac.yaml: |

    # Nats setup
    nats-addr: nats://{{ .Release.Name }}-nats.{{ .Release.Namespace }}.svc.cluster.local:4222

    # CSub setup
{{- with (index .Values.guac.collectSub.svcPorts 0) }}
    csub-addr: {{ $.Values.guac.collectSub.name }}.{{ $.Release.Namespace }}.svc.cluster.local:{{ .targetPort }}
    csub-listen-port: {{ .targetPort }}
{{- end }}

    # GQL setup
    gql-backend: {{ $.Values.guac.graphqlServer.backend }}
    gql-debug: {{ $.Values.guac.graphqlServer.debug }}
    gql-test-data: false
{{- with (index .Values.guac.graphqlServer.svcPorts 0) }}
    gql-addr: http://{{ $.Values.guac.graphqlServer.name }}.{{ $.Release.Namespace }}.svc.cluster.local:{{ .targetPort }}/query
    gql-listen-port: {{ .targetPort }}
{{- end }}

    # ArangoDB setup
    arango-addr: http://{{ $.Values.guac.arangoDb.name }}.{{ $.Release.Namespace }}.svc.cluster.local:8529
    
    # Collector behavior
    service-poll: true
    use-csub: true